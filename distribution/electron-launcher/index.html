<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIOwerk Control Panel</title>
    <style>
        :root {
            --bg: #1c1c1c;
            --panel: #252525;
            --card: #2e2e2e;
            --border: #3a3a3a;
            --text: #f2f2f2;
            --muted: #cfd8dc;
            --primary: #0b6e3f;
            --danger: #b71c1c;
            --secondary: #0d47a1;
            --warning: #b36b00;
            --focus: #80cbc4;
            --shadow: rgba(0, 0, 0, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #242424 100%);
            color: var(--text);
            overflow: hidden;
        }

        a {
            color: inherit;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 12px;
            background: #ffffff;
            color: #000000;
            padding: 10px 14px;
            z-index: 1000;
            border-radius: 6px;
            text-decoration: none;
            box-shadow: 0 4px 10px var(--shadow);
            transition: top 0.2s ease;
        }

        .skip-link:focus {
            top: 12px;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 270px;
            background: var(--panel);
            padding: 20px;
            border-right: 1px solid var(--border);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--muted);
            margin-bottom: 28px;
            text-align: center;
        }

        .nav-item {
            width: 100%;
            padding: 12px 15px;
            margin: 6px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            color: var(--text);
            background: transparent;
            text-align: left;
            font-size: 15px;
        }

        .nav-item:hover,
        .nav-item:focus-visible {
            background: #303030;
            border-color: var(--border);
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .nav-item.active {
            background: var(--primary);
            color: #ffffff;
            border-color: var(--primary);
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            margin-bottom: 18px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 6px;
        }

        .helper-text {
            font-size: 13px;
            color: var(--muted);
            margin-top: 6px;
        }

        .status-badge {
            display: inline-flex;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: bold;
            align-items: center;
            gap: 6px;
        }

        .status-info { background: #2b3a4a; color: #ffffff; }
        .status-warning { background: var(--warning); color: #ffffff; }
        .status-running { background: var(--primary); color: #ffffff; }
        .status-stopped { background: var(--danger); color: #ffffff; }
        .status-starting { background: var(--warning); color: #ffffff; }

        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #ffffff;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:focus-visible {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .btn-primary { background: var(--primary); }
        .btn-danger { background: var(--danger); }
        .btn-secondary { background: var(--secondary); }
        .btn-warning { background: var(--warning); }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 18px;
            margin: 18px 0;
        }

        .service-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 18px;
            transition: all 0.2s ease;
        }

        .service-card:hover,
        .service-card:focus-visible {
            border-color: var(--focus);
            box-shadow: 0 6px 12px var(--shadow);
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }

        .service-name {
            font-size: 18px;
            font-weight: 700;
        }

        .service-status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
        }

        .service-status-dot.running { background: var(--primary); box-shadow: 0 0 8px var(--primary); }
        .service-status-dot.stopped { background: var(--danger); }
        .service-status-dot.starting { background: var(--warning); }

        .service-info {
            font-size: 13px;
            color: var(--muted);
            margin-top: 10px;
            line-height: 1.4;
        }

        .service-actions {
            display: flex;
            gap: 10px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .service-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            background: #3a3a3a;
            color: #ffffff;
            transition: all 0.2s ease;
        }

        .service-btn:hover,
        .service-btn:focus-visible {
            background: #4a4a4a;
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .logs-container {
            background: #1a1a1a;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 18px;
            height: 420px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 18px 0;
        }

        .log-line { padding: 2px 0; color: #c5c5c5; }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin: 18px 0;
        }

        .quick-link {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .quick-link:hover,
        .quick-link:focus-visible {
            border-color: var(--secondary);
            box-shadow: 0 6px 12px var(--shadow);
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .quick-link-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .docker-status {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        .alert {
            padding: 14px;
            border-radius: 6px;
            margin: 12px 0;
            border: 1px solid transparent;
        }

        .alert-error { background: #3b1b1b; border-color: var(--danger); }
        .alert-success { background: #1f3327; border-color: var(--primary); }
        .alert-info { background: #1f2d3b; border-color: var(--secondary); }

        .hidden { display: none; }

        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .settings-form {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 18px;
            margin: 18px 0;
        }

        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: #1a1a1a;
            color: var(--text);
            font-size: 14px;
        }

        .summary-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link" id="skip-link">Skip to main content</a>
    <div class="container">
        <nav class="sidebar" aria-label="Primary navigation" id="primary-nav">
            <div class="logo" id="logo-text">üß¨ BIOwerk</div>
            <button class="nav-item active" type="button" data-page="dashboard" id="nav-dashboard">Dashboard</button>
            <button class="nav-item" type="button" data-page="services" id="nav-services">Services</button>
            <button class="nav-item" type="button" data-page="logs" id="nav-logs">Logs</button>
            <button class="nav-item" type="button" data-page="links" id="nav-links">Quick Links</button>
            <button class="nav-item" type="button" data-page="settings" id="nav-settings">Settings</button>
        </nav>

        <main class="main-content" id="main-content" tabindex="-1">
            <!-- Dashboard Page -->
            <section id="dashboard-page" class="page" role="region" aria-labelledby="dashboard-heading" tabindex="-1">
                <div class="header">
                    <h1 id="dashboard-heading">BIOwerk Control Panel</h1>
                    <p id="dashboard-intro">Manage your Bio-Themed Agentic Office Suite</p>
                    <p class="helper-text" id="dashboard-helper">
                        Monitor launch health, remediation alerts, and keyboard-friendly controls for start, stop, refresh, and restart.
                    </p>
                </div>

                <div class="docker-status" role="status" aria-live="polite">
                    <div class="summary-row">
                        <strong id="docker-status-label">Docker Status:</strong>
                        <span id="docker-status" class="status-badge status-starting">Checking...</span>
                        <span id="last-checked" class="helper-text"></span>
                    </div>
                    <p class="helper-text" id="docker-helper">Verifies Docker install and daemon readiness across macOS, Windows, and Linux.</p>
                </div>

                <div id="alert-container" aria-live="assertive"></div>

                <div class="control-buttons" aria-label="Service controls">
                    <button class="btn btn-primary" id="start-btn">‚ñ∂Ô∏è Start Services</button>
                    <button class="btn btn-danger" id="stop-btn">‚èπÔ∏è Stop Services</button>
                    <button class="btn btn-warning" id="restart-btn">üîÑ Restart Services</button>
                    <button class="btn btn-secondary" id="refresh-btn">üîÉ Refresh Status</button>
                </div>

                <div class="summary-row" role="status" aria-live="polite">
                    <div id="services-summary" class="status-badge status-info"></div>
                </div>

                <h2 id="status-heading">Service Status</h2>
                <p class="helper-text" id="status-helper">Tooltips surface remediation guidance for alerts, metrics, and actions; focus order follows the page layout.</p>
                <div id="services-container" class="services-grid"></div>
            </section>

            <!-- Services Page -->
            <section id="services-page" class="page hidden" role="region" aria-labelledby="services-heading" tabindex="-1">
                <div class="header">
                    <h1 id="services-heading">Services Management</h1>
                    <p class="helper-text" id="services-helper">Focus any card to review status, URLs, and remediation actions with clear labels.</p>
                </div>
                <div id="services-detail-container" class="services-grid"></div>
            </section>

            <!-- Logs Page -->
            <section id="logs-page" class="page hidden" role="region" aria-labelledby="logs-heading" tabindex="-1">
                <div class="header">
                    <h1 id="logs-heading">Service Logs</h1>
                    <p class="helper-text" id="logs-helper">Use keyboard to focus the latest log output; screen readers announce new lines as they stream.</p>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-secondary" id="view-all-logs">All Services</button>
                    <button class="btn btn-secondary" id="clear-logs">Clear Logs</button>
                </div>
                <div id="logs-display" class="logs-container" aria-live="polite" role="log" aria-label="Service log output"></div>
            </section>

            <!-- Quick Links Page -->
            <section id="links-page" class="page hidden" role="region" aria-labelledby="links-heading" tabindex="-1">
                <div class="header">
                    <h1 id="links-heading">Quick Links</h1>
                    <p class="helper-text" id="links-helper">Tooltips describe each dashboard; links open in your default browser.</p>
                </div>
                <div class="quick-links" id="quick-links"></div>
            </section>

            <!-- Settings Page -->
            <section id="settings-page" class="page hidden" role="region" aria-labelledby="settings-heading" tabindex="-1">
                <div class="header">
                    <h1 id="settings-heading">Settings</h1>
                </div>
                <div class="settings-form">
                    <div class="form-group">
                        <label id="config-label">Configuration File</label>
                        <button class="btn btn-secondary" id="open-config-btn">Open .env File</button>
                        <p class="helper-text" id="config-helper" style="margin-top: 10px; font-size: 12px;">
                            Edit environment variables, API keys, and service configuration
                        </p>
                    </div>
                    <div class="form-group">
                        <label id="compose-label">Docker Compose File</label>
                        <p style="font-size: 12px; color: #999;">
                            <span id="compose-description">Located at:</span> <code id="compose-path"></code>
                        </p>
                    </div>
                    <div class="form-group">
                        <label for="locale-select" id="locale-label">Language</label>
                        <select id="locale-select" aria-describedby="locale-helper"></select>
                        <p class="helper-text" id="locale-helper">Switch languages to validate truncation, RTL layout, and localization coverage.</p>
                        <button class="btn btn-secondary" id="apply-locale-btn" style="margin-top: 8px;">Apply language</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const {
            translate: t,
            resolveLocale,
            getAvailableLocales,
            formatDateTime,
            formatNumber,
            isRTL,
            getLocaleMeta
        } = require('./locales');

        let currentLocale = resolveLocale(navigator.language);
        let lastStatusChecked = null;
        let latestServices = null;

        const quickLinks = [
            { key: 'apiDocs', url: 'http://localhost:8080/docs', icon: 'üìö' },
            { key: 'grafana', url: 'http://localhost:3000', icon: 'üìä' },
            { key: 'prometheus', url: 'http://localhost:9090', icon: 'üìà' },
            { key: 'osteon', url: 'http://localhost:8080/v1/osteon/draft', icon: 'üìù' },
            { key: 'myocyte', url: 'http://localhost:8080/v1/myocyte/analyze', icon: 'üìä' },
            { key: 'synapse', url: 'http://localhost:8080/v1/synapse/create', icon: 'üé®' }
        ];

        const navButtons = {
            dashboard: document.getElementById('nav-dashboard'),
            services: document.getElementById('nav-services'),
            logs: document.getElementById('nav-logs'),
            links: document.getElementById('nav-links'),
            settings: document.getElementById('nav-settings')
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const savedLocale = localStorage.getItem('biowerk-locale');
            currentLocale = resolveLocale(savedLocale || (await ipcRenderer.invoke('get-locale').catch(() => currentLocale)));
            applyLocale(currentLocale);
            wireNavigation();
            wireControls();
            renderQuickLinks();
            populateLocaleSelect();
            requestComposePath();
            setTimeout(() => {
                ipcRenderer.send('check-status');
            }, 500);
        });

        function wireNavigation() {
            Object.values(navButtons).forEach((button) => {
                button.addEventListener('click', () => switchPage(button.getAttribute('data-page')));
            });
        }

        function switchPage(page) {
            Object.values(navButtons).forEach((btn) => {
                const isActive = btn.getAttribute('data-page') === page;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-current', isActive ? 'page' : 'false');
            });

            document.querySelectorAll('.page').forEach((section) => section.classList.add('hidden'));
            const pageEl = document.getElementById(`${page}-page`);
            pageEl.classList.remove('hidden');
            pageEl.focus({ preventScroll: false });
        }

        function wireControls() {
            document.getElementById('start-btn').addEventListener('click', () => ipcRenderer.send('start-services'));
            document.getElementById('stop-btn').addEventListener('click', () => ipcRenderer.send('stop-services'));
            document.getElementById('restart-btn').addEventListener('click', () => ipcRenderer.send('restart-services'));
            document.getElementById('refresh-btn').addEventListener('click', () => ipcRenderer.send('check-status'));
            document.getElementById('view-all-logs').addEventListener('click', () => ipcRenderer.send('view-logs', null));
            document.getElementById('clear-logs').addEventListener('click', clearLogs);
            document.getElementById('open-config-btn').addEventListener('click', () => ipcRenderer.send('open-config'));
            document.getElementById('apply-locale-btn').addEventListener('click', () => {
                const selected = document.getElementById('locale-select').value;
                currentLocale = resolveLocale(selected);
                localStorage.setItem('biowerk-locale', currentLocale);
                ipcRenderer.send('set-locale', currentLocale);
                applyLocale(currentLocale);
                showAlert(t(currentLocale, 'alerts.localeUpdated', { language: getLocaleMeta(currentLocale).label }), 'info');
            });
        }

        function applyLocale(locale) {
            document.documentElement.lang = locale;
            document.documentElement.dir = isRTL(locale) ? 'rtl' : 'ltr';
            renderStaticText(locale);
            renderQuickLinks();
            populateLocaleSelect();
            if (latestServices) {
                updateServicesDisplay(latestServices);
            }
            if (lastStatusChecked) {
                updateLastChecked();
            }
        }

        function renderStaticText(locale) {
            const setText = (id, key, vars) => {
                const el = document.getElementById(id);
                if (el) el.textContent = t(locale, key, vars);
            };

            document.title = t(locale, 'app.title');
            setText('skip-link', 'app.skipLink');
            const logo = document.getElementById('logo-text');
            logo.textContent = `üß¨ ${t(locale, 'app.title')}`;

            document.getElementById('primary-nav').setAttribute('aria-label', t(locale, 'nav.label'));
            setText('nav-dashboard', 'nav.dashboard');
            setText('nav-services', 'nav.services');
            setText('nav-logs', 'nav.logs');
            setText('nav-links', 'nav.links');
            setText('nav-settings', 'nav.settings');

            navButtons.dashboard.setAttribute('aria-label', t(locale, 'nav.dashboardAria'));
            navButtons.services.setAttribute('aria-label', t(locale, 'nav.servicesAria'));
            navButtons.logs.setAttribute('aria-label', t(locale, 'nav.logsAria'));
            navButtons.links.setAttribute('aria-label', t(locale, 'nav.linksAria'));
            navButtons.settings.setAttribute('aria-label', t(locale, 'nav.settingsAria'));

            setText('dashboard-heading', 'sections.dashboardTitle');
            setText('dashboard-intro', 'sections.dashboardIntro');
            setText('dashboard-helper', 'app.helper');
            setText('docker-status-label', 'hero.dockerStatusLabel');
            const dockerStatusEl = document.getElementById('docker-status');
            dockerStatusEl.textContent = t(locale, 'hero.dockerStatusChecking');
            dockerStatusEl.className = 'status-badge status-starting';
            setText('docker-helper', 'hero.dockerHelper');
            setText('status-heading', 'sections.statusHeading');
            setText('status-helper', 'sections.statusHelper');
            setText('services-heading', 'sections.servicesTitle');
            setText('services-helper', 'sections.servicesHelper');
            setText('logs-heading', 'sections.logsTitle');
            setText('logs-helper', 'sections.logsHelper');
            setText('links-heading', 'sections.linksTitle');
            setText('links-helper', 'sections.linksHelper');
            setText('settings-heading', 'sections.settingsTitle');

            setText('start-btn', 'buttons.start');
            setText('stop-btn', 'buttons.stop');
            setText('restart-btn', 'buttons.restart');
            setText('refresh-btn', 'buttons.refresh');
            setText('view-all-logs', 'buttons.allLogs');
            setText('clear-logs', 'buttons.clearLogs');
            setText('config-label', 'settings.configLabel');
            setText('open-config-btn', 'settings.openEnv');
            setText('config-helper', 'settings.configHelper');
            setText('compose-label', 'settings.composeLabel');
            setText('compose-description', 'settings.composeLocated');
            setText('locale-label', 'settings.localeLabel');
            setText('locale-helper', 'settings.localeHelper');
            setText('apply-locale-btn', 'buttons.applyLocale');

            document.getElementById('start-btn').setAttribute('aria-label', t(locale, 'buttons.startAria'));
            document.getElementById('stop-btn').setAttribute('aria-label', t(locale, 'buttons.stopAria'));
            document.getElementById('restart-btn').setAttribute('aria-label', t(locale, 'buttons.restartAria'));
            document.getElementById('refresh-btn').setAttribute('aria-label', t(locale, 'buttons.refreshAria'));
            document.getElementById('logs-display').setAttribute('aria-label', t(locale, 'logs.ariaLabel'));

            renderStatusSummary(0, 0);
        }

        function renderQuickLinks() {
            const container = document.getElementById('quick-links');
            container.innerHTML = '';
            quickLinks.forEach((link) => {
                const linkText = t(currentLocale, `quickLinks.${link.key}`);
                const anchor = document.createElement('a');
                anchor.className = 'quick-link';
                anchor.href = link.url;
                anchor.setAttribute('role', 'link');
                anchor.setAttribute('aria-label', t(currentLocale, 'quickLinks.ariaLabel', { name: linkText }));
                anchor.setAttribute('title', linkText);
                anchor.addEventListener('click', (e) => {
                    e.preventDefault();
                    ipcRenderer.send('open-url', link.url);
                });

                const icon = document.createElement('div');
                icon.className = 'quick-link-icon';
                icon.textContent = link.icon;

                const label = document.createElement('div');
                label.textContent = linkText;

                anchor.appendChild(icon);
                anchor.appendChild(label);
                container.appendChild(anchor);
            });
        }

        function populateLocaleSelect() {
            const select = document.getElementById('locale-select');
            const current = currentLocale;
            select.innerHTML = '';
            getAvailableLocales().forEach((locale) => {
                const option = document.createElement('option');
                option.value = locale.code;
                option.textContent = locale.label;
                if (locale.code === current) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function requestComposePath() {
            ipcRenderer.invoke('get-compose-path').then((path) => {
                const composeEl = document.getElementById('compose-path');
                composeEl.textContent = path;
                composeEl.setAttribute('aria-label', path);
            }).catch(() => {});
        }

        function updateServicesDisplay(services) {
            if (!services) return;
            const container = document.getElementById('services-container');
            const detailContainer = document.getElementById('services-detail-container');

            container.innerHTML = '';
            detailContainer.innerHTML = '';

            const serviceEntries = Object.entries(services);
            const runningCount = serviceEntries.filter(([, svc]) => svc.status === 'running').length;
            const total = serviceEntries.length;
            renderStatusSummary(runningCount, total);

            for (const [key, service] of serviceEntries) {
                container.appendChild(createServiceCard(key, service));
                detailContainer.appendChild(createServiceCard(key, service));
            }
        }

        function renderStatusSummary(running, total) {
            const summaryEl = document.getElementById('services-summary');
            summaryEl.textContent = t(currentLocale, 'app.statusSummary', {
                running: formatNumber(currentLocale, running),
                total: formatNumber(currentLocale, total)
            });
        }

        function createServiceCard(key, service) {
            const card = document.createElement('div');
            card.className = 'service-card';
            card.setAttribute('role', 'group');
            card.setAttribute('tabindex', '0');

            const name = t(currentLocale, service.translationKey || `services.${key}`);
            const statusText = t(currentLocale, `statuses.${service.status || 'stopped'}`);

            card.setAttribute('aria-label', t(currentLocale, 'services.statusLabel', {
                name,
                status: statusText
            }));

            card.innerHTML = `
                <div class="service-header">
                    <div class="service-name">${name}</div>
                    <div class="service-status-dot ${service.status || 'stopped'}" title="${statusText}">
                        <span class="sr-only">${statusText}</span>
                    </div>
                </div>
                <div class="service-info">
                    ${t(currentLocale, 'statuses.' + (service.status || 'stopped'))}<br>
                    URL: <code>${service.url}</code>
                </div>
                <div class="service-actions">
                    <button class="service-btn" data-url="${service.url}" aria-label="${t(currentLocale, 'buttons.openService')} ${name}">${t(currentLocale, 'buttons.openService')}</button>
                    <button class="service-btn" data-logs="${key}" aria-label="${t(currentLocale, 'buttons.openLogs')} ${name}">${t(currentLocale, 'buttons.openLogs')}</button>
                </div>
                <p class="helper-text">${t(currentLocale, 'services.cardHelper')}</p>
            `;

            card.querySelectorAll('[data-url]').forEach((btn) => btn.addEventListener('click', () => openUrl(service.url)));
            card.querySelectorAll('[data-logs]').forEach((btn) => btn.addEventListener('click', () => viewServiceLogs(key)));
            return card;
        }

        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.setAttribute('role', 'alert');
            alert.textContent = message;
            container.appendChild(alert);

            setTimeout(() => alert.remove(), 6000);
        }

        function appendLog(log) {
            const logsDisplay = document.getElementById('logs-display');
            const logLine = document.createElement('div');
            logLine.className = 'log-line';
            logLine.textContent = log;
            logsDisplay.appendChild(logLine);
            logsDisplay.scrollTop = logsDisplay.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs-display').innerHTML = '';
        }

        function openUrl(url) {
            ipcRenderer.send('open-url', url);
        }

        function viewServiceLogs(service) {
            switchPage('logs');
            ipcRenderer.send('view-logs', service);
        }

        // IPC Listeners
        ipcRenderer.on('docker-status', (_event, data) => {
            const statusEl = document.getElementById('docker-status');
            if (data.installed) {
                statusEl.className = 'status-badge status-running';
                statusEl.textContent = `${t(currentLocale, 'docker.installed')} - ${data.version}`;
            } else {
                statusEl.className = 'status-badge status-stopped';
                statusEl.textContent = t(currentLocale, 'docker.notInstalled');
                showAlert(t(currentLocale, 'alerts.dockerNotInstalled'), 'error');
            }
            updateLastChecked();
        });

        ipcRenderer.on('docker-daemon-status', (_event, data) => {
            const statusEl = document.getElementById('docker-status');
            if (!data.running) {
                statusEl.className = 'status-badge status-warning';
                statusEl.textContent = `${statusEl.textContent} ${t(currentLocale, 'hero.dockerDaemonNotRunning')}`;
                showAlert(t(currentLocale, 'alerts.dockerDaemonDown'), 'error');
            } else {
                statusEl.className = 'status-badge status-running';
                statusEl.textContent = `${t(currentLocale, 'docker.installed')} - ${t(currentLocale, 'docker.ready')}`;
            }
            updateLastChecked();
        });

        ipcRenderer.on('services-status', (_event, services) => {
            latestServices = services;
            updateServicesDisplay(services);
            updateLastChecked();
        });

        ipcRenderer.on('operation-status', (_event, data) => {
            const message = data.messageKey ? t(currentLocale, data.messageKey) : data.message;
            showAlert(message, data.status === 'error' ? 'error' : 'success');
        });

        ipcRenderer.on('operation-log', (_event, log) => {
            appendLog(log);
        });

        ipcRenderer.on('service-logs', (_event, data) => {
            appendLog(`[${data.service}] ${data.log}`);
        });

        function updateLastChecked() {
            lastStatusChecked = new Date();
            const lastCheckedEl = document.getElementById('last-checked');
            lastCheckedEl.textContent = t(currentLocale, 'app.lastChecked', {
                time: formatDateTime(currentLocale, lastStatusChecked)
            });
        }
    </script>
</body>
</html>
